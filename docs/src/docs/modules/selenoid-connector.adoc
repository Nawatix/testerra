= Selenoid connector

include::../properties/property-attributes.adoc[]

Using a Selenium Grid based on https://github.com/aerokube/selenoid[Selenoid] this module provides access to videos and VNC streams.

The module will register automatically by using Testera <<Hooks>>.

== Project setup

Current release: image:https://img.shields.io/bintray/v/testerra-io/Testerra/eu.tsystems.mms.tic.testerra:selenoid-connector?label=Testerra%20Selenoid%20connector[Bintray]

.Gradle
[source,gradle,role="primary"]
----
// build.gradle
implementation 'eu.tsystems.mms.tic.testerra:selenoid-connector:1.0'
----

.Maven
[source,xml,role="secondary"]
----
<!-- pom.xml -->
<dependencies>
    <dependency>
        <groupId>eu.tsystems.mms.tic.testerra</groupId>
        <artifactId>selenoid-connector</artifactId>
        <version>1.0</version>
    </dependency>
</dependencies>
----

== Video support

The Selenoid connector can collect the generated video stream and provide it for the Testerra report.

.Activate the video screencaster
[source,properties,subs="attributes"]
----
# test.properties
# activate generation of screencast in general, default = false
{screencaster_active}=true
# activate appending of screencast to report for failed tests, default = true
{screencaster_active_on_failed} = true
# activate appending of screencast to report for successful tests, default = false
{screencaster_active_on_success} = true
----

After finishing the test run Testerra collects the video files and adds them to the report.


.You will find all video files in the method detail view in a separate tab.
image::selenoid_connector_report_video_tab.png[]

IMPORTANT: By default Testerra adds video files only to failed methods.

== VNC support

For debugging you tests in a Selenoid grid you can activate the support for linking the VNC streaming URL. As VNC client we are using https://github.com/novnc/noVNC[noVNC].

=== Set up a noVNC server.
* Please not that your Grid must be available by your noVNC client.
* We prefer to use one the many Docker images available at https://hub.docker.com/.

=== Configure your `test.properties` file

[source,properties,subs="attributes"]
----
# test.properties
{selenoid_vnc_enabled}=true
{selenoid_vnc_address}=http://<your-no-vnc-client>:<port>/vnc.html
----

=== Start your test locally

Starting your test in your local IDE you will find the VNC client URL in the log messages.

The URL can only be generated if a browser session was started successfully.

.Some IDEs mark the URL as clickable link.
image::selenoid_connector_vnc_url.png[]

== Configuration

[cols="2,^1,4a",options="header"]
|===
| Property | default | Description
|{screencaster_active} | true | Video files will be generated for test methods and for exclusive sessions.
|{screencaster_active_on_success}| false | When true, generated video files will be attached the report for successful test methods
|{screencaster_active_on_failed} | true | Generated video files will be attached the report for failed test methods
|{selenoid_vnc_enabled} | true | VNC Stream will be activated and logged to the console.
|{selenoid_vnc_address} |  | VNC Host address - Will be used to generate a unique url for accessing the VNC session.
|===
