<template>
    <mdc-layout-grid class="pt0">
        <mdc-layout-grid-inner>
            <mdc-layout-grid-cell span="3">
                <mdc-card top-position="offset:16;" class.bind="_sticky?'sticky':''" reached.delegate="_stickyStepNav($event)">
                    <mdc-list two-line single-selection>
                        <mdc-list-item repeat.for="testStep of _methodDetails.methodContext.testSteps" click.delegate="_gotoStep($index+1)">
                            <!--mdc-icon mdc-list-item-graphic>read_more</mdc-icon-->
                            <mdc-list-item-primary-text>${$index+1} ${testStep.name}</mdc-list-item-primary-text>
                            <mdc-list-item-secondary-text>${testStep.testStepActions[0].timestamp|dateFormat}</mdc-list-item-secondary-text>
                        </mdc-list-item>
                    </mdc-list>
                </mdc-card>
            </mdc-layout-grid-cell>
            <mdc-layout-grid-cell span="9">
                <div repeat.for="testStep of _methodDetails.methodContext.testSteps">
                    <let step-index.bind="$index+1"></let>
                    <a name="${stepIndex}" visible.delegate="_stepVisibility($event)" become-visible></a>
                    <div mdc-headline4 class.bind="stepIndex!=1?'mt1':''">${stepIndex} ${testStep.name}</div>

                    <div repeat.for="testStepAction of testStep.testStepActions">
                        <div if.bind="!$first&&!$last" mdc-headline5 class="mt1">${stepIndex}.${$index+1} ${testStepAction.name}</div>
                        <mdc-card class="mt1" if.bind="testStepAction.optionalAssertions.length > 0">
                            <div mdc-subtitle2 class="card-headline">Failed optional assertions</div>
                            <mdc-list-divider></mdc-list-divider>
                            <mdc-expandable repeat.for="errorContext of testStepAction.optionalAssertions"
                                            class="card-expandable status-skipped"
                            >
                                <div slot="caption" mdc-body2><class-name namespace.bind="errorContext.cause.className"><span if.bind="errorContext.cause.message">: ${errorContext.cause.message}</span></class-name></div>
                                <code-view lines.bind="errorContext.scriptSource.lines"
                                           mark-class="warn"
                                ></code-view>
                            </mdc-expandable>
                        </mdc-card>
                        <mdc-card class="mt1" if.bind="_screenshots.length>0">
                            <div mdc-subtitle2 class="card-headline">Screenshots</div>
                            <mdc-list-divider></mdc-list-divider>
                            <mdc-card
                                class="m1 thumbnail-fixed"
                                repeat.for="screenshotId of testStepAction.screenshotIds"
                                outlined
                            >
                                <let file.bind="_findScreenshot(screenshotId)"></let>
                                <img src.bind="file.relativePath"
                                     class="thumbnail-fixed clickable"
                                     click.delegate="_showScreenshot(file)"
                                     title="${file.meta.Title}"/>
                            </mdc-card>
                        </mdc-card>
                        <mdc-card class="mt1">
                            <div mdc-subtitle2 class="card-headline">Logs</div>
                            <mdc-list-divider></mdc-list-divider>
                            <log-view log-messages.bind="testStepAction.logMessages"></log-view>
                        </mdc-card>
                    </div>

                </div>
            </mdc-layout-grid-cell>
        </mdc-layout-grid-inner>
    </mdc-layout-grid>
</template>
