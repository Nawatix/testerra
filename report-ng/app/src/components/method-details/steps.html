<template>
    <require from="components/image-card/image-card"></require>

    <mdc-layout-grid class="pt0">
        <mdc-layout-grid-inner>
            <mdc-layout-grid-cell span="3">
                <mdc-list-group repeat.for="testStep of _methodContext.testSteps">
                    <let step-index.bind="$index+1"></let>
                    <h3>${stepIndex} ${testStep.name}</h3>
                    <mdc-list two-line single-selection>
                        <mdc-list-item repeat.for="testStepAction of testStep.testStepActions">
                            <mdc-icon mdc-list-item-graphic>read_more</mdc-icon>
                            <mdc-list-item-primary-text>${stepIndex}.${$index+1} ${testStepAction.name}</mdc-list-item-primary-text>
                            <mdc-list-item-secondary-text>${testStepAction.timestamp|dateFormat:"ddd MMM D Y LTS Z"}</mdc-list-item-secondary-text>
                        </mdc-list-item>
                    </mdc-list>
                </mdc-list-group>
            </mdc-layout-grid-cell>
            <mdc-layout-grid-cell span="9">
                <!-- fullwidth breaks label -->
                <mdc-text-field label="Search"
                                outlined
                                value.bind="queryParams.q"
                                keydown.delegate="_filter() & debounce"
                                class="w100"
                >
                    <mdc-icon mdc-text-field-icon leading>search</mdc-icon>
                </mdc-text-field>
                <div repeat.for="testStep of _methodContext.testSteps">
                    <let step-index.bind="$index+1"></let>
                    <mdc-card repeat.for="testStepAction of testStep.testStepActions"
                                class="mt1"
                    >
                        <div mdc-subtitle2 class="card-headline"><span class="sr1">${stepIndex}.${$index+1} ${testStepAction.name}</span></div>
                        <mdc-list-divider></mdc-list-divider>
                        <div class="code-view m0">
                        <pre class="m0"
                             repeat.for="logMessage of testStepAction.logMessages"
                             class.bind="(logMessage.type==1?'error':(logMessage.type==2?'warn':''))"
                        >${logMessage|logMessageFormat}</pre>
                        </div>
                        <div class="m0" if.bind="_screenshots.length>0">
                            <div repeat.for="screenshotId of testStepAction.screenshotIds">
                                <let file.bind="_findScreenshot(screenshotId)"></let>
                                <image-card click.delegate="_showScreenshot(file)"
                                            src.bind="file.relativePath"
                                            title.bind="file.meta.Title"
                                ></image-card>
                            </div>
                        </div>
                    </mdc-card>
                </div>
            </mdc-layout-grid-cell>
        </mdc-layout-grid-inner>
    </mdc-layout-grid>
</template>
